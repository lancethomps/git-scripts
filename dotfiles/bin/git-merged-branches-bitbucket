#!/usr/bin/env bash
################################################################### SETUP ########################################################################
if ! _SCRIPT_DIR="$(get_script_dir "${BASH_SOURCE[0]}")"; then echo "Error while running: _SCRIPT_DIR=\"\$(get_script_dir \"${BASH_SOURCE[0]}\")\"" && exit 1; fi
# shellcheck disable=SC1090
if test -e "${_SCRIPT_DIR}/.git_command_defaults.sh"; then source "${_SCRIPT_DIR}/.git_command_defaults.sh"; else echo '"${_SCRIPT_DIR}/.git_command_defaults.sh" does not exist - resolved to: '"${_SCRIPT_DIR}/.git_command_defaults.sh" && exit 1; fi
##################################################################################################################################################

if ! bb_merged_branches_regex="$(git merged-branches-bitbucket-regex)" || test -z "$bb_merged_branches_regex"; then
  echo "No Bitbucket MERGED branches found"
  exit 1
elif check_verbose; then
  echo "bb_merged_branches_regex -> $bb_merged_branches_regex"
fi

git branches-info refs/remotes --color=always "$@" | grep -v -E "$GIT_BRANCH_SKIP_REGEX" | grep -E "$bb_merged_branches_regex"
