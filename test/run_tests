#!/usr/bin/env bash
################################################################### SETUP ########################################################################
S="${BASH_SOURCE[0]}" && while [ -h "$S" ]; do D="$(cd -P "$(dirname "$S")" && pwd)" && S="$(readlink "$S")" && [[ $S != /* ]] && S="$D/$S"; done || true && _SCRIPT_DIR="$(cd -P "$(dirname "$S")" && pwd)" && unset S D
set -o errexit -o errtrace -o nounset
##################################################################################################################################################

cd "$_SCRIPT_DIR"
mapfile -t test_scripts < <(find -Ls "." -type f -perm +111 -not -name run_tests)
exit_val=0

for test_script in "${test_scripts[@]}"; do
  echo "${test_script}"
  echo "##################################################################################################################################################"
  if ! "$test_script"; then
    exit_val=1
  fi
  echo "##################################################################################################################################################"
  echo
done

exit "$exit_val"
